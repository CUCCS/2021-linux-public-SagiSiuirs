# 第一章：Linux基础-实验

### 20210314

---

### 实验要求：

- 配置无人值守安装iso并在Virtualbox中完成自动化安装

---

### 软件环境：

- Virtualbox
- Ubuntu 20.04 Server 64bit

---

### 实验过程：

1. 下载纯净版Ubuntu安装镜像文件（ubuntu-20.04.2-live-server-amd64.iso）

2. 手动安装Ubuntu：

   - 具体操作跟着老师的视频进行

   ![用户设置](/img/1用户设置.png)

   - 根据其他同学近日讨论总结的经验，换源安装成功

   ![安装成功](/img/1.2安装成功.png)

3. 获得并修改user-data文件

   - 从安装镜像的虚拟机中传出user-data文件

   ![传出user-data](/img/2传出user-data.png)

   - 根据老师提供的示例进行配置

   ![配置user-data](/img/3配置user-data.png)

   - 修改之后的user-data内容如下：

     ```yaml
     #cloud-config
     autoinstall:
       apt:
         geoip: true
         preserve_sources_list: false
         primary:
         - arches: [amd64, i386]
           uri: http://mirrors.aliyun.com/ubuntu/
           #换镜像源
         - arches: [default]
           uri: https://mirrors.aliyun.com/ubuntu-ports/
           #换镜像源
       identity: {hostname: sagi, password: $6$gMfMIKlrIRdskffO$Ug919/u.SpZ0MS2oz1TYeU.67glYKULLFo32LbpChglicBh5PKGOMmbTULaiPpIOsGpHX7Bjad0O5LOGEDgnt0,
         realname: sagi, username: sagi}
         #添加用户
       keyboard: {layout: us, toggle: null, variant: ''}
       timezone: Asia/Shanghai
       locale: en_US.UTF-8
       #修改时区和语言
       network:
         ethernets:
           enp0s3: {dhcp4: true}
           enp0s8: {dhcp4: true}
         version: 2
       ssh:
         allow-pw: true
         authorized-keys: []
         install-server: true
       storage:
         config:
         - {ptable: gpt, path: /dev/sda, wipe: superblock,
           preserve: false, name: '', grub_device: true, type: disk, id: disk-sda}
         - {device: disk-sda, size: 1MB, flag: bios_grub, number: 1, preserve: false,
           grub_device: false, type: partition, id: partition-0}
         - {device: disk-sda, size: 1GB, wipe: superblock, flag: '', number: 2,
           preserve: false, grub_device: false, type: partition, id: partition-1}
         - {fstype: ext4, volume: partition-1, preserve: false, type: format, id: format-0}
         - {device: disk-sda, size: -1, wipe: superblock, flag: '', number: 3,
           preserve: false, grub_device: false, type: partition, id: partition-2}
         - name: ubuntu-vg
           devices: [partition-2]
           preserve: false
           type: lvm_volgroup
           id: lvm_volgroup-0
         - {name: ubuntu-lv, volgroup: lvm_volgroup-0, size: -1, preserve: false,
           type: lvm_partition, id: lvm_partition-0}
         - {fstype: ext4, volume: lvm_partition-0, preserve: false, type: format, id: format-1}
         - {device: format-1, path: /, type: mount, id: mount-1}
         - {device: format-0, path: /boot, type: mount, id: mount-0}
       version: 1
     ```

     

4. 制作包含user-data和meta-data的ISO镜像文件

   - 修改保存user-data，创建名为meta-data的空文件
   - 将这两个文件传输到Linux虚拟机中

   ![传入两个文件](/img/4传入两个文件.png)

   - 连接ssh

   ![连接ssh](/img/5连接ssh.png)

   - 将iso文件传出到物理主机中

   ![导出iso](/img/6导出iso.png)

5. 新建虚拟机进行无人值守安装

   - 按顺序载入Ubuntu镜像和无人值守镜像

   ![新建虚拟机](/img/7新建虚拟机.png)

   - 启动后只需输入一次yes命令即可自动完成Ubuntu安装

   ![安装完成](/img/8安装完成.png)

6. 检查ssh连接情况和ip地址

   ![检查](/img/9检查.png)

---

### 问题与解决

- 在手动安装Ubuntu镜像的过程中，出现安装失败的情况

  ![安装失败](/img/10安装失败.png)

  搜索引擎解决无果，根据近日其他同学讨论得出的经验，尝试换源安装（http://mirrors.aliyun.com/ubuntu/）

  随后成功

